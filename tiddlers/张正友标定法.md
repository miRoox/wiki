**张正友标定法**（Zhang's Calibration Method）是[计算机视觉](#计算机视觉)中广泛使用的一种相机标定方法，由张正友于1998年提出。它通过拍摄平面标定板（如棋盘格）的多张图像，求解相机的内参矩阵、外参矩阵和畸变系数。以下是其原理与操作方法的详细介绍：

---

### **一、原理**
#### 1. **核心思想**
- **平面标定板**：使用平面棋盘格作为标定目标，通过多张不同角度的图像获取对应点的像素坐标。
- **单应性矩阵（Homography）**：建立标定板平面（3D）与图像平面（2D）之间的投影关系，通过单应性矩阵描述这一映射。
- **闭式解（Closed-Form Solution）**：利用多组单应性矩阵联立方程，求解相机的内参矩阵初始值。
- **非线性优化**：通过最大似然估计（MLE）优化初始解，考虑畸变参数以提高精度。

#### 2. **数学模型**
- **相机模型**：  
  $$
  s \begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = 
  \begin{bmatrix} 
  f_x & \gamma & u_0 \\ 
  0 & f_y & v_0 \\ 
  0 & 0 & 1 
  \end{bmatrix}
  \begin{bmatrix} 
  R & t 
  \end{bmatrix}
  \begin{bmatrix} 
  X \\ Y \\ 0 \\ 1 
  \end{bmatrix}
  $$  
  其中：  
  - $f_x, f_y$：焦距（像素单位）  
  - $u_0, v_0$：主点坐标  
  - $\gamma$：轴间倾斜因子（通常为0）  
  - $R, t$：旋转矩阵和平移向量（外参）  
  - $X, Y$：标定板角点的3D坐标（Z=0）  

- **单应性矩阵**：  
  $$
  H = K \begin{bmatrix} r_1 & r_2 & t \end{bmatrix}
  $$  
  其中 $H$ 是3×3矩阵，$r_1, r_2$ 是旋转矩阵的前两列。

- **畸变模型**：  
  考虑径向畸变（$k_1, k_2$）和切向畸变（$p_1, p_2$）：  
  $$
  x_{\text{corrected}} = x(1 + k_1 r^2 + k_2 r^4) + 2p_1 xy + p_2 (r^2 + 2x^2) \\
  y_{\text{corrected}} = y(1 + k_1 r^2 + k_2 r^4) + p_1 (r^2 + 2y^2) + 2p_2 xy
  $$

---

### **二、操作步骤**
#### 1. **准备标定板**
- 使用黑白棋盘格图案，确保角点清晰且数量足够（如8×6的方格）。
- 标定板需平整，角点坐标已知（通常以左上角为原点，间距固定）。

#### 2. **采集图像**
- 从不同角度拍摄至少10张标定板图像（建议15-20张），覆盖整个视野。
- 标定板需倾斜、旋转，并分布在图像的不同区域。

#### 3. **角点检测**
- 使用算法（如OpenCV的`findChessboardCorners`）检测每张图像的角点像素坐标。
- 亚像素级优化（如`cornerSubPix`）提高角点定位精度。

#### 4. **计算单应性矩阵**
- 对每张图像，建立标定板角点（3D）与图像角点（2D）的对应关系，计算单应性矩阵 $H$。

#### 5. **求解内参初始值**
- 联立多组单应性矩阵方程，构造约束条件，求解内参矩阵 $K$ 的闭式解。

#### 6. **优化所有参数**
- 将闭式解作为初始值，结合畸变参数，通过非线性优化（如Levenberg-Marquardt算法）最小化重投影误差：
  $$
  \sum_{i=1}^{n} \sum_{j=1}^{m} \| p_{ij} - \hat{p}(K, k_1, k_2, p_1, p_2, R_i, t_i, P_j) \|^2
  $$
  其中 $p_{ij}$ 是实际角点坐标，$\hat{p}$ 是投影坐标。

#### 7. **输出标定结果**
- 内参矩阵 $K$、畸变系数 $[k_1, k_2, p_1, p_2]$、每张图像的外参 $R, t$。

---

### **三、优点与局限性**
#### **优点**
- 仅需平面标定板，成本低、操作简便。
- 结合闭式解与非线性优化，精度较高。
- 开源工具（如OpenCV）提供成熟实现（`calibrateCamera`函数）。

#### **局限性**
- 假设图像中心是主点（$u_0, v_0$），可能不适用于某些镜头。
- 忽略高阶畸变（如$k_3$），对鱼眼镜头效果有限。

---

### **四、应用注意事项**
1. **标定板质量**：打印清晰，避免反光或变形。
2. **图像覆盖范围**：标定板需覆盖图像边缘，以充分约束畸变。
3. **光照均匀**：避免阴影或过曝影响角点检测。
4. **验证标定结果**：通过重投影误差评估（通常要求误差<0.5像素）。

---

张正友标定法因其高效性和实用性，成为工业检测、机器人导航、AR/VR等领域的标准标定方法。通过合理操作和参数优化，可满足大多数场景的精度需求。

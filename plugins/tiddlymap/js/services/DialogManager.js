"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,t){for(var l=0;l<t.length;l++){var a=t[l];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,l,a){if(l)e(t.prototype,l);if(a)e(t,a);return t}}();/* @preserve TW-Guard */
/*\

title: $:/plugins/felixhayashi/tiddlymap/js/DialogManager
type: application/javascript
module-type: library

@preserve

\*/
/* @preserve TW-Guard */var _utils=require("$:/plugins/felixhayashi/tiddlymap/js/utils");var _utils2=_interopRequireDefault(_utils);var _CallbackManager=require("$:/plugins/felixhayashi/tiddlymap/js/CallbackManager");var _CallbackManager2=_interopRequireDefault(_CallbackManager);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var DialogManager=function(){function e(t,l){_classCallCheck(this,e);this.callbackManager=t;this.context=l}_createClass(e,[{key:"open",value:function t(l){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=arguments[2];if(_utils2.default.isTrue($tm.config.sys.suppressedDialogs[l],false)){$tm.logger("warning","Suppressed dialog",l);return}$tm.logger("debug","Dialog param object",a);if(typeof i==="function"&&this.context){i=i.bind(this.context)}var r=$tm.path.tempRoot+"/dialog-"+_utils2.default.genUUID();var u=_utils2.default.getTiddler($tm.path.dialogs+"/"+l);var n={title:r,buttons:u.fields["buttons"]||"ok_cancel",classes:"tmap-modal-content "+u.fields["classes"],output:r+"/output",result:r+"/result",temp:r+"/temp",template:u.fields.title,templateId:l,currentTiddler:r+"/output",text:_utils2.default.getText($tm.path.dialogs)};_utils2.default.touch(n.output);if(a.dialog){if(a.dialog.preselects){$tw.wiki.addTiddler(new $tw.Tiddler({title:n.output},_utils2.default.flatten(a.dialog.preselects)));delete a.dialog.preselects}_utils2.default.merge(n,a.dialog)}n.footer=_utils2.default.getText($tm.path.footers);n=_utils2.default.flatten(n);a=_utils2.default.flatten(a);var s=function t(l){e.getElement("hidden-close-button").click();var a=$tw.wiki.getTiddler(l);var u=a.fields.text;var s=null;if(u){s=$tw.wiki.getTiddler(n.output)}else{$tm.notify("operation cancelled")}if(typeof i==="function"){i(u,s)}_utils2.default.deleteByPrefix(r)};this.callbackManager.add(n.result,s,true);var o=new $tw.Tiddler(u,a,n);$tw.wiki.addTiddler(o);$tm.logger("debug","Opening dialog",o);$tw.rootWidget.dispatchEvent({type:"tm-modal",param:o.fields.title,paramObject:o.fields});return o}}],[{key:"getElement",value:function e(t){return _utils2.default.getFirstElementByClassName("tmap-"+t)}}]);return e}();exports.default=DialogManager;